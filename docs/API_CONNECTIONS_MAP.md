# ุฎุฑูุทุฉ ุงุชุตุงูุงุช API โ ูุธุงู ุชุทุจูุจู
## API Connections Map โ Tatubu School Management System

> **ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** ูุจุฑุงูุฑ 2026 | **ุงููุทุงู:** ุฌููุน ุงูุงุชุตุงูุงุช ุงูุฏุงุฎููุฉ ูุงูุฎุงุฑุฌูุฉ

---

## ูุธุฑุฉ ุดุงููุฉ ุนูู ุงูุงุชุตุงูุงุช / Full Connections Overview

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                     โ
โ   [ูุชุตูุญ ุงููุณุชุฎุฏู / Browser]                                                        โ
โ   React PWA (Frontend)                                                              โ
โ        โ                                                                            โ
โ        โ  HTTPS  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ        โ  REST API (JSON)                                                           โ
โ        โผ                                                                            โ
โ   [Nginx Reverse Proxy]  (:443)                                                     โ
โ        โ                                                                            โ
โ        โโโโบ /api/*   โโโโโโโโโโโโโโโบ [Flask Backend]  (:5000)                      โ
โ        โ                                   โ                                        โ
โ        โ                         โโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโ                โ
โ        โ                         โ         โ                      โ                โ
โ        โ                         โผ         โผ                      โผ                โ
โ        โ                      [MySQL]   [Redis]       โโโโโโโโโโโโโโโโโโโโโ        โ
โ        โ                      (:3306)   (:6379)       โ  External APIs    โ        โ
โ        โ                                              โ                   โ        โ
โ        โ                                              โ  iBulk SMS  โโโโโบ โโโโบ Omanโ
โ        โ                                              โ  VAPID Push โโโโโบ โโโโบ FCM โ
โ        โ                                              โ  Evolution  โโโโโบ โ        โ
โ        โ                                              โโโโโโโโโโโโโโโโโโโโโ        โ
โ        โ                                                      โ                    โ
โ        โโโโบ /evolution/* โโโโโโโบ [Evolution API] (:8080) โโโโโ                    โ
โ                                        โ                                           โ
โ                                        โโโโโโโโโโโโโโโโโโโโโโโโโโโโบ WhatsApp       โ
โ                                                                      Servers        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ุฌุฏูู ุงูุงุชุตุงูุงุช ุงููุงูู / Complete Connections Table

| # | ุงููุฑุณูู | ุงููุณุชูุจูู | ุงููุฒูุฏ / Provider | ุงูุจุฑูุชูููู | ุทุฑููุฉ ุงููุตุงุฏูุฉ | ุงูุจูุงูุงุช ุงููููููุฉ | ุงูุงุชุฌุงู |
|---|---|---|---|---|---|---|---|
| 1 | React Frontend | Flask Backend | **ุฐุงุชู / Self-hosted** | HTTPS / REST | JWT Bearer Token | ุจูุงูุงุช ุงููุณุชุฎุฏูุ ุงูุญุถูุฑุ ุงูุญุงููุงุชุ ุงูุฌุฏุงูู | ุซูุงุฆู ุงูุงุชุฌุงู |
| 2 | Flask Backend | MySQL Database | **ุฐุงุชู / Self-hosted** | TCP (PyMySQL) | Username + Password | ุฌููุน ุจูุงูุงุช ุงูุชุทุจูู | ุซูุงุฆู ุงูุงุชุฌุงู |
| 3 | Flask Backend | Redis Cache | **ุฐุงุชู / Self-hosted** | TCP | Password (ุงุฎุชูุงุฑู) | ุนุฏุงุฏุงุช Rate Limiting | ุซูุงุฆู ุงูุงุชุฌุงู |
| 4 | Flask Backend | Evolution API | **ุฐุงุชู / Self-hosted** | HTTP / REST | API Key | ุฑูู ุงููุงุชู + ูุต ุงูุฑุณุงูุฉ | ุฃุญุงุฏู (Flask โ Evo) |
| 5 | Evolution API | WhatsApp Servers | **Meta / WhatsApp** | HTTPS (Baileys) | QR Code Session | ุฑุณุงุฆู WhatsApp | ุซูุงุฆู ุงูุงุชุฌุงู |
| 6 | Flask Backend | iBulk SMS API | **iBulk SMS โ ุนููุงู** | HTTPS / REST | Username + Password | ุฑูู ุงููุงุชู + ูุต ุงูุฑุณุงูุฉ | ุฃุญุงุฏู (Flask โ iBulk) |
| 7 | Flask Backend | VAPID Push Servers | **Google FCM / Apple APNs** | HTTPS (Web Push) | VAPID Private Key | ุนููุงู + ูุต ุงูุฅุดุนุงุฑ | ุฃุญุงุฏู (Flask โ Push) |
| 8 | Browser (PWA) | Push Servers | **Google FCM / Apple APNs** | HTTPS | Subscription Endpoint | ุงุณุชูุจุงู ุงูุฅุดุนุงุฑ | ุฃุญุงุฏู (Push โ Browser) |
| 9 | Nginx | Flask Backend | **ุฐุงุชู / Self-hosted** | HTTP (ุฏุงุฎูู) | Proxy Pass | ูู ุทูุจุงุช /api/* | ุซูุงุฆู ุงูุงุชุฌุงู |
| 10 | Nginx | Evolution API | **ุฐุงุชู / Self-hosted** | HTTP (ุฏุงุฎูู) | Proxy Pass | ูู ุทูุจุงุช /evolution/* | ุซูุงุฆู ุงูุงุชุฌุงู |

---

## ุชูุตูู ูู ุงุชุตุงู / Detailed Connection Breakdown

---

### 1. React Frontend โ Flask Backend API

```
โโโโโโโโโโโโโโโโโโโโ     HTTPS / REST      โโโโโโโโโโโโโโโโโโโโโโโโ
โ  React PWA       โ โโโโโโโโโโโโโโโโโโโโโโบ โ  Flask Backend       โ
โ  (ุงููุชุตูุญ)       โ โโโโโโโโโโโโโโโโโโโโโโ โ  (/api/*)            โ
โโโโโโโโโโโโโโโโโโโโ     JSON Response      โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | ุฐุงุชู (Self-hosted) |
| **ุงูุจุฑูุชูููู** | HTTPS + REST |
| **ุตูุบุฉ ุงูุจูุงูุงุช** | JSON |
| **ุงููุตุงุฏูุฉ** | `Authorization: Bearer <JWT_TOKEN>` ูู ูู ุทูุจ |
| **ุงูุงุชุฌุงู** | ุซูุงุฆู (Request / Response) |
| **ุงููููุฐ** | 443 (HTTPS ุนุจุฑ Nginx) โ 5000 ุฏุงุฎููุงู |
| **ููุชุจุฉ ุงูุงุชุตุงู** | Axios 1.4.0 (Frontend) |
| **ุงูุญูุงูุฉ** | CORS ูุญุฏูุฏ + Rate Limiting + JWT |

**ููุงุท ุงูููุงูุฉ ุงูุฑุฆูุณูุฉ (Endpoints):**

| ุงููุธููุฉ | Method | Endpoint |
|---|---|---|
| ุชุณุฌูู ุงูุฏุฎูู | POST | `/api/auth/login` |
| ุชุณุฌูู ุงูุญุถูุฑ | POST | `/api/attendance/takes` |
| ูุณุญ QR ุงูุญุงููุฉ | POST | `/api/bus/scan` |
| ุฅุฑุณุงู ุฅุดุนุงุฑ | POST | `/api/notifications` |
| ุงูุงุดุชุฑุงู ูู Push | POST | `/api/notifications/subscribe` |
| ุทูุจ ุงุณุชูุงู ุทุงูุจ | POST | `/api/parent-pickup/request-pickup` |
| ุฅุฑุณุงู SMS | POST | `/api/attendance/send-daily-sms-reports` |
| ุฅุฑุณุงู WhatsApp | POST | `/api/auth/send-absence-notifications` |

---

### 2. Flask Backend โ MySQL Database

```
โโโโโโโโโโโโโโโโโโโโ     TCP (PyMySQL)     โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flask Backend   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  MySQL Server        โ
โ  (SQLAlchemy ORM)โ โโโโโโโโโโโโโโโโโโโโโโ โ  (tatubu_db)         โ
โโโโโโโโโโโโโโโโโโโโ   Parameterized SQL    โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | ุฐุงุชู (Self-hosted) |
| **ุงูุจุฑูุชูููู** | TCP ุนูู ุงููููุฐ 3306 |
| **ุทุฑููุฉ ุงููุตูู** | SQLAlchemy ORM 2.0 + PyMySQL 1.1.1 |
| **ุงููุตุงุฏูุฉ** | Username + Password (ูุชุบูุฑุงุช ุงูุจูุฆุฉ) |
| **ุงูุงุชุฌุงู** | ุซูุงุฆู (ูุฑุงุกุฉ/ูุชุงุจุฉ) |
| **ุงูุดุจูุฉ** | ุฏุงุฎูู ููุท โ `127.0.0.1:3306` (ูุง ูููุชุญ ููุฎุงุฑุฌ) |
| **ุงูุญูุงูุฉ** | Parameterized queries (ููุน SQL Injection) |

---

### 3. Flask Backend โ Redis Cache

```
โโโโโโโโโโโโโโโโโโโโ        TCP            โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flask-Limiter   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  Redis Server        โ
โ  (Rate Limiting) โ โโโโโโโโโโโโโโโโโโโโโโ โ  (:6379)             โ
โโโโโโโโโโโโโโโโโโโโ   Counter Read/Write   โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | ุฐุงุชู (Self-hosted) |
| **ุงูุจุฑูุชูููู** | RESP (Redis Serialization Protocol) / TCP |
| **ุงููุตุงุฏูุฉ** | ูููุฉ ูุฑูุฑ ุงุฎุชูุงุฑูุฉ |
| **ุงูุงุชุฌุงู** | ุซูุงุฆู |
| **ุงูุดุจูุฉ** | ุฏุงุฎูู ููุท โ `127.0.0.1:6379` |
| **ุงูุจูุงูุงุช ุงููุฎุฒูุฉ** | ุนุฏุงุฏุงุช Rate Limiting ููุท (ูุง ุจูุงูุงุช ูุณุชุฎุฏููู) |
| **TTL** | ุชูุชูู ุตูุงุญูุฉ ุงูููุงุชูุญ ุชููุงุฆูุงู |

---

### 4. Flask Backend โ Evolution API (WhatsApp)

```
โโโโโโโโโโโโโโโโโโโโ     HTTP / REST       โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flask Backend   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  Evolution API       โ
โ  (Notification   โ     POST /message/     โ  (Docker Container)  โ
โ   Service)       โ     sendText/{inst}    โ  (:8080)             โ
โโโโโโโโโโโโโโโโโโโโ                        โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | ุฐุงุชู (Self-hosted) โ Evolution API ููุชูุญ ุงููุตุฏุฑ |
| **ุงูุจุฑูุชูููู** | HTTP ุฏุงุฎูู โ REST |
| **ุงููุตุงุฏูุฉ** | Header: `apikey: <EVOLUTION_API_KEY>` |
| **ุงูุงุชุฌุงู** | ุฃุญุงุฏู (Flask ูุฑุณู ููุท) |
| **ุงูุดุจูุฉ** | ุฏุงุฎูู โ `localhost:8080` ุฃู Docker network |
| **ุงูุจูุงูุงุช ุงููุฑุณูุฉ** | `{ number: "9687XXXXXXXX", text: "ูุต ุงูุฑุณุงูุฉ" }` |
| **ุงูุจูุงูุงุช ุงูููุนุงุฏุฉ** | `{ key: { id: "..." }, status: "PENDING" }` |
| **ุงูุชุฎุฒูู** | ูุง ุชูุฎุฒููู ุงูุฑุณุงุฆู ูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุทุจูู |
| **ุงูุฅุนุฏุงุฏ ููู ูุฏุฑุณุฉ** | instance_name + api_key + api_url ูุณุชููุฉ |

**Endpoints ุงููุณุชุฎุฏูุฉ:**

| ุงููุธููุฉ | Method | Endpoint |
|---|---|---|
| ุฅุฑุณุงู ุฑุณุงูุฉ ูุตูุฉ | POST | `{api_url}/message/sendText/{instance}` |
| ุญุงูุฉ ุงูุงุชุตุงู | GET | `{api_url}/instance/connectionState/{instance}` |
| ุงูุญุตูู ุนูู QR | GET | `{api_url}/instance/connect/{instance}` |

---

### 5. Evolution API โ WhatsApp Servers (Meta)

```
โโโโโโโโโโโโโโโโโโโโ     HTTPS (Baileys)   โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Evolution API   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  WhatsApp Servers    โ
โ  (Baileys lib)   โ  WhatsApp Web Protocol โ  (Meta Infrastructureโ
โโโโโโโโโโโโโโโโโโโโ                        โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | Meta / WhatsApp |
| **ุงูุจุฑูุชูููู** | HTTPS + WebSocket (WhatsApp Web Protocol) |
| **ููุชุจุฉ ุงูุงุชุตุงู** | Baileys 7.0.0-rc.9 (ููุชูุญ ุงููุตุฏุฑ) |
| **ุงููุตุงุฏูุฉ** | QR Code session (ูุณุญ ูุฑุฉ ูุงุญุฏุฉ ููู ูุฏุฑุณุฉ) |
| **ุงูุงุชุฌุงู** | ุซูุงุฆู (ุฅุฑุณุงู ูุงุณุชูุจุงู) |
| **ุงูุฌูุณุฉ** | ุชูุฎุฒููู ูู Docker volume (`evolution_instances`) |
| **ุงูุจูุงูุงุช ุงููุฑุณูุฉ** | ุฑูู ูุงุชู ุงููุณุชูุจูู + ูุต ุงูุฑุณุงูุฉ |
| **ููุงุญุธุฉ** | ูุนุชูุฏ ุนูู WhatsApp Web โ ุบูุฑ ุฑุณูู ูู Meta |

---

### 6. Flask Backend โ iBulk SMS API

```
โโโโโโโโโโโโโโโโโโโโ     HTTPS / REST      โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flask Backend   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  iBulk SMS API       โ
โ  (ibulk_sms_     โ     POST (send SMS)    โ  (Oman Provider)     โ
โ   service.py)    โ                        โ                      โ
โโโโโโโโโโโโโโโโโโโโ                        โโโโโโโโโโโโโโโโโโโโโโโโ
                                                     โ
                                                     โผ
                                            ุดุจูุงุช ุงูุงุชุตุงู ุงูุนููุงููุฉ
                                            (ูุงุชู ููู ุงูุฃูุฑ)
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | iBulk SMS โ ูุฒูุฏ ุนููุงูู ูุญูู |
| **ุงูุจุฑูุชูููู** | HTTPS / REST |
| **ุงููุตุงุฏูุฉ** | Username + Password (ูุฎุฒูุฉ ููู ูุฏุฑุณุฉ ูู DB) |
| **ุงูุงุชุฌุงู** | ุฃุญุงุฏู (Flask ูุฑุณู ููุท) |
| **ุงูุจูุงูุงุช ุงููุฑุณูุฉ** | ุฑูู ุงููุงุชู + ูุต ุงูุฑุณุงูุฉ + Sender ID |
| **ุงูุจูุงูุงุช ุงูููุนุงุฏุฉ** | ุญุงูุฉ ุงูุฅุฑุณุงู + ุฑุตูุฏ ุงูุญุณุงุจ |
| **ุงูุฅุนุฏุงุฏ ููู ูุฏุฑุณุฉ** | credentials ูุณุชููุฉ ููู ูุฏุฑุณุฉ |
| **ุงูุงุณุชุฎุฏุงู** | ุชูุงุฑูุฑ ุงูุญุถูุฑ ุงูููููุฉ + ุฅุดุนุงุฑุงุช ุงูุบูุงุจ |

**ุนูููุงุช ุงููุชุงุญุฉ:**

| ุงููุธููุฉ | ุงููุตู |
|---|---|
| `send_sms()` | ุฅุฑุณุงู ุฑุณุงูุฉ ููุงุชู ูุงุญุฏ |
| `send_bulk_sms()` | ุฅุฑุณุงู ููุฌููุนุฉ ูู ุงูุฃุฑูุงู |
| `check_balance()` | ุงูุชุญูู ูู ุงูุฑุตูุฏ ุงููุชุจูู |

---

### 7. Flask Backend โ VAPID Push Servers

```
โโโโโโโโโโโโโโโโโโโโ     HTTPS (Web Push)  โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Flask Backend   โ โโโโโโโโโโโโโโโโโโโโโโบ โ  Push Server         โ
โ  (pywebpush)     โ  Encrypted Payload     โ  (Google FCM /       โ
โโโโโโโโโโโโโโโโโโโโ                        โ   Apple APNs)        โ
                                            โโโโโโโโโโโโฌโโโโโโโโโโโโ
                                                       โ
                                                       โผ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
                                            โ  Service Worker      โ
                                            โ  (ุงููุชุตูุญ / Browser) โ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | Google FCM (Android/Chrome) + Apple APNs (iOS 16.4+) |
| **ุงูุจุฑูุชูููู** | HTTPS + W3C Web Push Standard |
| **ุงูููุชุจุฉ** | pywebpush 1.14.1 |
| **ุงููุตุงุฏูุฉ** | VAPID Private Key (ูุฎุฒู ูู `.env` ููุท) |
| **ุงูุงุชุฌุงู** | ุฃุญุงุฏู (Flask โ Push Server โ Browser) |
| **ุชุดููุฑ ุงูุญูููุฉ** | ูุดูุฑุฉ end-to-end ุจุงุณุชุฎุฏุงู ููุชุงุญ ุงูุงุดุชุฑุงู (p256dh) |
| **ุงูุชุณููู** | ููุณูููู ุญุชู ูู ูุงู ุงูุชุทุจูู ูุบููุงู |
| **ุงูุจูุงูุงุช ุงููุฑุณูุฉ** | ุนููุงู ุงูุฅุดุนุงุฑ + ุงููุต + ุฑุงุจุท ุงุฎุชูุงุฑู |

---

### 8. Browser (PWA) โ Push Notification Servers

```
โโโโโโโโโโโโโโโโโโโโ   Subscribe (HTTPS)   โโโโโโโโโโโโโโโโโโโโโโโโ
โ  Browser PWA     โ โโโโโโโโโโโโโโโโโโโโโโบ โ  Push Server         โ
โ  (Service Worker)โ                        โ  (FCM / APNs)        โ
โ                  โ โโโโโโโโโโโโโโโโโโโโโโ โ                      โ
โโโโโโโโโโโโโโโโโโโโ  Receive Notification  โโโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ showNotification()
    ุฅุดุนุงุฑ ูุธูุฑ ุนูู ุงูุดุงุดุฉ
    (ุญุชู ูู ุงูุชุทุจูู ูุบูู)
```

| ุงูุฎุงุตูุฉ | ุงูุชูุตูู |
|---|---|
| **ุงููุฒูุฏ** | Google FCM / Apple APNs |
| **ุงูุจุฑูุชูููู** | HTTPS + WebSocket (PushManager API) |
| **ุงููุตุงุฏูุฉ** | VAPID Public Key (ุขูู ูููุดุงุฑูุฉ) |
| **ุงูุงุชุฌุงู** | ุฃุญุงุฏู (Push โ Browser) |
| **ุงูุงุดุชุฑุงู** | `navigator.serviceWorker` + `PushManager.subscribe()` |
| **endpoint URL** | ููุฎุฒููู ูู `push_subscriptions` (ูุงุนุฏุฉ ุงูุจูุงูุงุช) |
| **ุงูุชุดุบูู ุจุฏูู ุงูุชุทุจูู** | Service Worker ูุณุชูุจู ุงูุฅุดุนุงุฑ ูู ุงูุฎูููุฉ |

---

## ููุฎุต ุงููุฒูุฏูู / Providers Summary

| ุงููุฒูุฏ | ุงูุฎุฏูุฉ | ุงููููุน | ููุน ุงูุงุณุชุถุงูุฉ | ุจุฑูุชูููู ุงูุงุชุตุงู |
|---|---|---|---|---|
| **Self-hosted** | Flask API | ุงูุณูุฑูุฑ ุงูุฎุงุต | On-premise / VPS | HTTP ุฏุงุฎูู |
| **Self-hosted** | MySQL | ุงูุณูุฑูุฑ ุงูุฎุงุต | On-premise / VPS | TCP :3306 |
| **Self-hosted** | Redis | ุงูุณูุฑูุฑ ุงูุฎุงุต | On-premise / VPS | TCP :6379 |
| **Self-hosted** | Evolution API | Docker Container | On-premise / VPS | HTTP :8080 |
| **Meta / WhatsApp** | WhatsApp Servers | ุฎูุงุฏู Meta ุงูุนุงูููุฉ | Cloud | HTTPS + WebSocket |
| **iBulk SMS** | SMS Gateway | ุนููุงู | Cloud (ุฎุงุฑุฌู) | HTTPS / REST |
| **Google** | Firebase Cloud Messaging (FCM) | ุฎูุงุฏู Google ุงูุนุงูููุฉ | Cloud | HTTPS / Web Push |
| **Apple** | Apple Push Notification Service (APNs) | ุฎูุงุฏู Apple ุงูุนุงูููุฉ | Cloud | HTTPS / Web Push |

---

## ูุณุงุฑ ุงูุจูุงูุงุช ููู ุญุฏุซ / Data Flow Per Event

### ุญุฏุซ: ุชุณุฌูู ุบูุงุจ ุทุงูุจ

```
ุงููุนูู (Browser)
    โ
    โโโ1โโโบ POST /api/attendance/takes  [HTTPS โ Nginx โ Flask]
    โ
    โโโ2โโโบ Flask ููุชุจ ูู MySQL  [TCP ุฏุงุฎูู]
    โ
    โโโ3โโโบ Flask ูุฑุณู ูู Evolution API  [HTTP ุฏุงุฎูู]
    โ            โโโโบ Evolution ูุฑุณู ูู WhatsApp Servers  [HTTPS]
    โ                        โโโโบ ูุตู ููุงุชู ููู ุงูุฃูุฑ ๐ฑ
    โ
    โโโ4โโโบ Flask ูุฑุณู ูู VAPID Push Servers  [HTTPS]
    โ            โโโโบ ูุตู ููุชุตูุญ ุงูุทุงูุจ/ููู ุงูุฃูุฑ ๐
    โ
    โโโ5โโโบ ุงุณุชุฌุงุจุฉ ูููุนูู โ  [JSON]
```

### ุญุฏุซ: ูุณุญ QR ุงูุญุงููุฉ

```
ุงูุณุงุฆู (Mobile Browser)
    โ
    โโโ1โโโบ ูุงููุฑุง ุชูุฑุฃ QR Code ุงูุทุงูุจ
    โ
    โโโ2โโโบ POST /api/bus/scan  [HTTPS โ Flask]
    โ
    โโโ3โโโบ Flask ููุชุจ BusScan ูู MySQL  [TCP ุฏุงุฎูู]
    โ
    โโโ4โโโบ Flask ูุฑุณู ุฅุดุนุงุฑ ูููู ุงูุฃูุฑ  [VAPID Push โ FCM]
    โ            โโโโบ ููู ุงูุฃูุฑ ูุณุชูุจู: "ุตุนุฏ ุงุจูู ุงูุญุงููุฉ" ๐
    โ
    โโโ5โโโบ ุงุณุชุฌุงุจุฉ ููุณุงุฆู: ุงุณู ุงูุทุงูุจ + ููุช ุงููุณุญ โ
```

### ุญุฏุซ: ุฅุฑุณุงู ุชูุฑูุฑ SMS ูููู

```
ุงูุฅุฏุงุฑุฉ (Browser)
    โ
    โโโ1โโโบ POST /api/attendance/send-daily-sms-reports  [HTTPS โ Flask]
    โ
    โโโ2โโโบ Flask ูุฌูุจ ุจูุงูุงุช ุงูุญุถูุฑ ูู MySQL  [TCP ุฏุงุฎูู]
    โ
    โโโ3โโโบ Flask ูุฑุณู ูู iBulk SMS API  [HTTPS]
    โ            โโโโบ iBulk ูุฑุณู SMS ูุฃูููุงุก ุงูุฃููุฑ  [ุดุจูุฉ ุนููุงููุฉ]
    โ                        โโโโบ ููู ุงูุฃูุฑ ูุณุชูุจู SMS ๐ฉ
    โ
    โโโ4โโโบ ุงุณุชุฌุงุจุฉ: ุนุฏุฏ ุงูุฑุณุงุฆู ุงูููุฑุณููุฉ + ุญุงูุฉ ุงูุฑุตูุฏ โ
```

### ุญุฏุซ: ุชุณุฌูู ุงูุฏุฎูู

```
ุงููุณุชุฎุฏู (Browser)
    โ
    โโโ1โโโบ POST /api/auth/login  { username, password }  [HTTPS]
    โ
    โโโ2โโโบ Flask ูุชุญูู ูู Redis: ูู ุชุฌุงูุฒ ุงูู Rate Limitุ  [TCP ุฏุงุฎูู]
    โ
    โโโ3โโโบ Flask ูุฌูุจ ุงููุณุชุฎุฏู ูู MySQL + ูุชุญูู ูู ุงูู Hash  [TCP ุฏุงุฎูู]
    โ
    โโโ4โโโบ Flask ูุณุฌู ูู action_logs (IP + ููุช)  [MySQL]
    โ
    โโโ5โโโบ ุงุณุชุฌุงุจุฉ: { access_token, refresh_token, user }  [JSON / HTTPS] โ
```

---

## ุงูููุงูุฐ ูุงูุดุจูุฉ / Ports & Network Map

```
ุงูุฅูุชุฑูุช
    โ
    โ :443 (HTTPS)
    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ุงูุณูุฑูุฑ ุงูุฎุงุต                       โ
โ                                                     โ
โ  [Nginx]  :80/:443  โโโบ redirect + proxy            โ
โ       โ                                             โ
โ       โโโโบ Flask     127.0.0.1:5000  (ุฏุงุฎูู ููุท)   โ
โ       โโโโบ Evo. API  127.0.0.1:8080  (ุฏุงุฎูู ููุท)   โ
โ                                                     โ
โ  [MySQL]   127.0.0.1:3306  (ุฏุงุฎูู ููุท)             โ
โ  [Redis]   127.0.0.1:6379  (ุฏุงุฎูู ููุท)             โ
โ                                                     โ
โ  [Evolution Manager UI]  127.0.0.1:4000  (ุฏุงุฎูู)   โ
โ                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                    โ                    โ
    โผ                    โผ                    โผ
iBulk SMS API      WhatsApp Servers     FCM / APNs
(Oman โ HTTPS)     (Meta โ HTTPS)    (Google/Apple โ HTTPS)
```

**ุงูููุงูุฐ ุงูููุชูุญุฉ ููุฎุงุฑุฌ ููุท:**

| ุงููููุฐ | ุงูุฎุฏูุฉ | ููุงุญุธุฉ |
|---|---|---|
| 443 | HTTPS | ูู ุญุฑูุฉ ุงูุจูุงูุงุช |
| 80 | HTTP | ููุนุงุฏ ุชูุฌููู ููุฑุงู ูู 443 |
| 22 | SSH | ููุฅุฏุงุฑุฉ ููุท (ููุชุงุญ ุฎุงุต) |
